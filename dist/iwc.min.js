var SJ=SJ||{};SJ.ns=function(e){var n=e.split("."),t=SJ;"SJ"===n[0]&&(n=n.slice(1));for(var o=0;o<n.length;o++){var r=n[o];void 0===t[r]&&(t[r]={}),t=t[r]}return t},function(e){var o={},r=0,n={}.toString,t={appName:window.applicationName||"DEFAULT",generateGUID:function(){var t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:7&n|8).toString(16)})},callback:function(e){if(SJ.isFunction(e)){var n=Array.prototype.slice.call(arguments,1);e.apply(window,n)}},windowOn:function(e,n){n.handlerId=++r;var t=function(e){e=e||window.event,n(e)};o[n.handlerId]=n,window.addEventListener?window.addEventListener(e,t,!1):window.attachEvent&&window.attachEvent("on"+e,t)},windowUn:function(e,n){window.removeEventListener?window.removeEventListener(e,o[n.handlerId],!1):window.detachEvent&&window.detachEvent("un"+e,o[n.handlerId]),delete o[n.handlerId]},isIE:function(){if(!window.ActiveXObject&&"ActiveXObject"in window)return 11;var e=navigator.userAgent.toLowerCase();return-1!==e.indexOf("msie")&&parseInt(e.split("msie")[1])},copy:function(e,n){var t;for(t in n)e[t]=n[t];return e},emptyFn:function(){},isEmpty:function(e){return null==e||""===e||SJ.isArray(e)&&0===e.length},isArray:"isArray"in Array?Array.isArray:function(e){return"[object Array]"===n.call(e)},isDate:function(e){return"[object Date]"===n.call(e)},isObject:function(e){return null!=e&&"[object Object]"===n.call(e)},isPrimitive:function(e){var n=typeof e;return"number"===n||"string"===n||"boolean"===n},isFunction:function(e){return!!e&&"[object Function]"===n.call(e)},isNumber:function(e){return"number"==typeof e&&isFinite(e)},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},isString:function(e){return"string"==typeof e},isBoolean:function(e){return"boolean"==typeof e}};t.copy(e,t)}(SJ),function(e){SJ.copy(e,{each:function(e,n){for(var t in e)if(e.hasOwnProperty(t)&&!1===n(e[t],t))break}})}(SJ.ns("Object")),function(e){function o(e){var i={};function r(e,n){for(var t=0;t<i[e].length;t++)i[e][t]===n&&i[e].splice(t,1)}function a(e,n,t){var o=i[e];if(o)for(var r=0;r<o.length;r++)if(o[r].fn===n&&o[r].scope===t)return o[r];return null}return e.on=function(e,n,t){i[e]||(i[e]=[]),a(e,n,t)||i[e].push({fn:n,scope:t})},e.once=function(e,n,t){a(e,n,t)||(i[e]=i[e]||[],i[e].push({fn:n,scope:t,single:!0}))},e.un=function(e,n,t){var o=a(e,n,t);o&&r(e,o)},e.fire=function(e){var n=i[e];if(n){n=[].concat(n);for(var t=Array.prototype.slice.call(arguments,1),o=0;o<n.length;o++)n[o].fn.apply(n[o].scope,t),n[o].single&&r(e,n[o])}},e}function r(){o(this)}r.decorate=function(e,n){var t;return n?(t=new r,e.on=t.on,e.un=t.un,e.once=t.once):t=o(e),t},e.Observable=r}(SJ.ns("utils")),function(e){var r=window.localStorage;void 0===r&&(r={getItem:function(){},setItem:function(){},removeItem:function(){}},alert("Local storage is not supported on this browser. Some features will not work."));var i,a,c,s=11===SJ.isIE(),o=new SJ.utils.Observable,u=10===SJ.isIE()||9===SJ.isIE();u||(c=new SJ.utils.Observable);var n=s?function(e){e=e||window.event,i=e.key,a=e.newValue,o.fire("storage",e),c.fire("storage",e)}:u?function(e){e=e||window.event,o.fire("storage",e)}:function(e){e=e||window.event,o.fire("storage",e),c.fire("storage",e)};if(window.addEventListener){var t=s?window.top:window;t.addEventListener("storage",n,!1),t!=window&&window.addEventListener("unload",function(){t.removeEventListener("storage",n,!1)})}else window.attachEvent&&document.attachEvent("onstorage",n);e.localStorage={onChanged:function(e,n,t){t&&!u?c.on("storage",e,n):o.on("storage",e,n)},onceChanged:function(e,n,t){t&&!u?c.once("storage",e,n):o.once("storage",e,n)},unChanged:function(e,n){o.un("storage",e,n),u||c.un("storage",e,n)},getItem:function(e){return s&&i===e?a:r.getItem(e)},setItem:u?function(e,n){s&&i===e&&(a=n),r.setItem(e,n)}:function(e,n){var t=this.getItem(e);s&&i===e&&(a=n),r.setItem(e,n);var o={key:e,oldValue:t,newValue:n,url:window.location.href.toString()};c.fire("storage",o)},removeItem:u?function(e){s&&i===e&&(a=null),r.removeItem(e)}:function(e){var n=this.getItem(e);s&&i===e&&(a=null),r.removeItem(e);var t={key:e,oldValue:n,newValue:null,url:window.location.href.toString()};c.fire("storage",t)},forEach:s?function(e){for(var n=0;n<r.length;n++){var t=r.key(n);if(!1===e(t,t===i?a:r.getItem(t)))break}}:function(e){for(var n=0;n<r.length;n++){var t=r.key(n);if(!1===e(t,r.getItem(t)))break}},setVersion:function(n,e){var t=this;if(t.getItem(n)!==e){var o=[];t.forEach(function(e){e.substr(0,n.length)===n&&o.push(e)}),o.forEach(function(e){t.removeItem(e)}),t.setItem(n,e)}}}}(SJ),function(e){var n="IWC_"+SJ.appName;e.getLocalStoragePrefix=function(){return n},e.$version="0.1.3",SJ.localStorage.setVersion(n,e.$version)}(SJ.ns("iwc")),function(l){var d=SJ.iwc.getLocalStoragePrefix()+"_TLOCK_",f=SJ.generateGUID();SJ.localStorage.onChanged(function(e){if(e.key){var n=!e.newValue&&!!e.oldValue;n&&e.key.substr(0,d.length)===d&&t()}else t()});var w=new SJ.utils.Observable;function t(){w.fire("storagechanged")}function e(r,i){var a=!1,n=!1,t=null,c=l.testingMode&&l.lockTimeout||3e3,s=function(){var e;n||(e=o,w.on("storagechanged",e),t=window.setInterval(o,50),n=!0)},u=function(){var e;n&&(e=o,w.un("storagechanged",e),window.clearInterval(t),n=!1)},o=function(){if(!a){var t=(new Date).getTime(),e=v(r);if(e&&t-e.timestamp<c)s();else{a=!0,u(),g(r,t);var o=window.setTimeout(function(){window.clearTimeout(o);var e,n=v(r);!n||n.timestamp===t&&n.lockerId===f?(u(),n||g(r,t),i(),l.testingMode||(e=d+r,SJ.localStorage.removeItem(e))):(a=!1,s())},10)}}};o()}function v(e){var n=d+e,t=SJ.localStorage.getItem(n),o=null;if(t){var r=t.split(".");o={timestamp:parseInt(r[0])||0,lockerId:r[1]}}return o}function g(e,n){var t=d+e;SJ.localStorage.setItem(t,n+"."+f)}l.interlockedCall=e,SJ.interlockedCall=e}(SJ.ns("iwc.Lock")),function(e){var n=function(e){var n=this;n._dataId=e,n._observable=new SJ.utils.Observable,n._serializedData=SJ.localStorage.getItem(n._dataId),SJ.localStorage.onChanged(n.onStorageChanged,n,!0)};n.prototype={constructor:n,get:function(){this._serializedData=SJ.localStorage.getItem(this._dataId);var e=null;return this._serializedData&&(e=JSON.parse(this._serializedData)),e},set:function(e,n){var t=this;SJ.iwc.Lock.interlockedCall(t._dataId,function(){t.writeToStorage(e),SJ.callback(n)})},change:function(n){var t=this;SJ.iwc.Lock.interlockedCall(t._dataId,function(){var e=t.get();e=n(e),t.writeToStorage(e)})},onChanged:function(e,n){this._observable.on("changed",e,n)},onceChanged:function(e,n){this._observable.once("changed",e,n)},unsubscribe:function(e,n){this._observable.un("changed",e,n)},writeToStorage:function(e){var n=null!==e?JSON.stringify(e):"";SJ.localStorage.setItem(this._dataId,n)},onStorageChanged:function(e){var n=this;if(!e.key||e.key===n._dataId){var t=SJ.localStorage.getItem(n._dataId);if(t!==n._serializedData){var o=null;(n._serializedData=t)&&(o=JSON.parse(t)),n._observable.fire("changed",o)}}}},e.SharedData=n}(SJ.ns("iwc")),function(e){var t=SJ.generateGUID(),r=new SJ.utils.Observable,i=new SJ.utils.Observable,o=SJ.iwc.getLocalStoragePrefix()+"_EBUS";SJ.localStorage.onChanged(function(e){if(e.key===o&&e.newValue){var n=JSON.parse(e.newValue);n.senderBusNodeId!==t&&(r.fire.apply(window,n.args),i.fire.apply(window,n.args))}}),SJ.copy(e,{on:function(e,n,t,o){o?i.on(e,n,t):r.on(e,n,t)},once:function(e,n,t,o){o?i.once(e,n,t):r.once(e,n,t)},un:function(e,n,t,o){o?i.un(e,n,t):r.un(e,n,t)},fire:function(){var e={senderBusNodeId:t,args:Array.prototype.slice.call(arguments,0)},n=JSON.stringify(e);SJ.localStorage.setItem(o,n),i.fire.apply(window,e.args)}})}(SJ.ns("iwc.EventBus")),function(e){var r=5e3,i=2e3,a={},c={},s=window.name||SJ.generateGUID(),t=!1,u=new SJ.utils.Observable,l=SJ.iwc.getLocalStoragePrefix()+"_WND_",n=r/2,o=l+s;function d(){var o={};return SJ.localStorage.forEach(function(e,n){if(n&&e.substr(0,l.length)===l){var t=e.substr(l.length);o[t]=parseInt(n)}}),function(e){var n=(new Date).getTime();for(var t in e)if(e.hasOwnProperty(t)&&t!==s){var o=n-e[t];2*r<o||r<o&&c[t]&&n-c[t]>i?(delete e[t],SJ.localStorage.removeItem(l+t)):r<o?c[t]||(c[t]=n,SJ.iwc.EventBus.fire("windowisaliverequest",t)):c[t]&&delete c[t]}for(var t in c)c.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&delete c[t]}(o),o}function f(){w();var e=(new Date).getTime();a[s]=e,SJ.localStorage.setItem(o,e),t||(t=!0,u.fire("windowsmanagerready"))}function w(){var e=d(),n=[];for(var t in e)e.hasOwnProperty(t)&&!a[t]&&n.push(t);var o,r,i=[];for(var t in a)a.hasOwnProperty(t)&&!e[t]&&i.push(t);a=e,(n.length||i.length)&&(o=n,r=i,u.fire("windowschanged",o,r))}function v(e){e===s&&(window.focus(),function(){if(g)return;var e=document.title,n=!1;g=6;var t=function(){document.title=n?e:"******",n=!n,--g&&window.setTimeout(t,500)};window.setTimeout(t,500)}())}SJ.windowOn("unload",function(){SJ.localStorage.removeItem(o)}),SJ.localStorage.onChanged(function(e){e.key?e.key.substr(0,l.length)===l&&w():w()}),SJ.iwc.EventBus.on("windowfocusrequest",v),SJ.iwc.EventBus.on("windowisaliverequest",function(e){e===s&&(f(),SJ.iwc.EventBus.fire("windowisaliveresponce",e))}),SJ.iwc.EventBus.on("windowisaliveresponce",function(e){e!==s&&c[e]&&delete c[e]}),f(),window.setInterval(f,n);var g=0;SJ.copy(e,{isWindowOpen:function(e){return!!a[e]},getOpenWindowIds:function(){var e=[];for(var n in a)a.hasOwnProperty(n)&&e.push(n);return e},setFocus:function(e){e?v(s):SJ.iwc.EventBus.fire("windowfocusrequest",e)},getThisWindowId:function(){return s},isReady:function(){return t},onReady:function(e,n){t?e.call(n):u.once("windowsmanagerready",e,n)},onWindowsChanged:function(e,n){u.on("windowschanged",e,n)},onceWindowsChanged:function(e,n){u.once("windowschanged",e,n)},unsubscribe:function(e,n){u.un("windowschanged",e,n)}})}(SJ.ns("iwc.WindowMonitor")),function(e){var d=SJ.iwc.getLocalStoragePrefix()+"_LOCK_",f=[],w=!1;SJ.localStorage.onChanged(function(e){if(e.key){var n=!e.newValue&&!!e.oldValue;n&&e.key.substr(0,d.length)===d&&S()}else S()});var v=new SJ.utils.Observable;function g(e){v.un("storagechanged",e)}function S(){v.fire("storagechanged")}function n(e,n){var t,o=!1,r=!1,i=!1,a=null,c={lockId:e,release:function(){r=!0,i&&(g(lock),i=!1),o&&(o=!1,function(e){var n=J(e);-1!==n&&f.splice(n,1);var t=d+e,o=SJ.localStorage.getItem(t);if(o){var r=JSON.parse(o);SJ.iwc.WindowMonitor.getThisWindowId()===r.ownerWindowId&&SJ.localStorage.removeItem(t)}S()}(e))},isCaptured:function(){return o},isReleased:function(){return r}},s=function(){var e;i||(e=l,v.on("storagechanged",e),a=window.setInterval(l,500),i=!0)},u=function(){i&&(g(l),window.clearInterval(a),i=!1)},l=function(){o||r||(p(e)?s():(u(),SJ.iwc.Lock.interlockedCall(e,function(){p(e)?(s(),p(e)||(u(),h(c),o=!0,n())):(h(c),o=!0,n())})))};return w?l():(t=l,v.once("locksinitialized",t)),c}function t(e){SJ.iwc.WindowMonitor.onReady(function(){SJ.localStorage.forEach(function(n,e){if(e&&n.substr(0,d.length)===d){var t=n.substr(d.length);o(t,e)&&SJ.iwc.Lock.interlockedCall(t,function(){var e=SJ.localStorage.getItem(n);e&&o(t,e)&&(SJ.localStorage.removeItem(n),S())})}}),e&&e()})}function o(e,n){var t=JSON.parse(n);if(!t||!t.timestamp||!t.ownerWindowId)return!0;var o=t.ownerWindowId===SJ.iwc.WindowMonitor.getThisWindowId();return!SJ.iwc.WindowMonitor.isWindowOpen(t.ownerWindowId)||o&&-1===J(e)}function h(e){var n={timestamp:(new Date).getTime(),ownerWindowId:SJ.iwc.WindowMonitor.getThisWindowId()},t=d+e.lockId;SJ.localStorage.setItem(t,JSON.stringify(n)),f.push(e)}function p(e){var n=d+e,t=SJ.localStorage.getItem(n);if(t){var o=JSON.parse(t);return SJ.iwc.WindowMonitor.isWindowOpen(o.ownerWindowId)}return!1}function J(e){for(var n=0;n<f.length;n++)if(f[n].lockId===e)return n;return-1}SJ.windowOn("unload",function(){!function(){for(var e=[].concat(f),n=0;n<e.length;n++)e[n].release()}()}),t(function(){SJ.iwc.WindowMonitor.onWindowsChanged(function(e,n){n.length&&t()}),w=!0,v.fire("locksinitialized")}),e.capture=n,SJ.lock=n}(SJ.ns("iwc.Lock")),function(e){var n=function(e,n){var t=this;t._serverId=e,t._isReady=!1,t._observable=SJ.utils.Observable.decorate(t,!0),t._serverDescriptionHolder=new SJ.iwc.SharedData(e);var o=t._serverDescriptionHolder.get();o&&t.updateContract(o),t._serverDescriptionHolder.onChanged(function(e){t.updateContract(e)}),n&&t.onReady(n)};n.prototype={constructor:n,onReady:function(e,n){this._isReady?e.call(n):this._observable.once("ready",e,n)},updateContract:function(e){var n=this;e.forEach(function(e){n[e]||(n[e]=n.createProxyMethod(e))}),n._isReady||(n._isReady=!0,n._observable.fire("ready"))},createProxyMethod:function(r){var i=this;return function(){var e=null,n=null,t=Array.prototype.slice.call(arguments,0);t.length&&SJ.isFunction(t[t.length-1])&&(e=SJ.generateGUID(),n=t.pop());var o={methodName:r,callId:e,args:t};SJ.iwc.EventBus.fire("servercall_"+i._serverId,o),e&&SJ.iwc.EventBus.once("servercallback_"+e,n)}}},e.Client=n}(SJ.ns("iwc")),function(e){var n=function(e,n){var t=this;t._serverId=e,t._serverDescriptionHolder=new SJ.iwc.SharedData(t._serverId),SJ.copy(t,n.exposed);var o=n.exposed;delete n.exposed,SJ.copy(t,n),SJ.lock(e,function(){t.onInit(),t.updateServerDescription(o),SJ.iwc.EventBus.on("servercall_"+t._serverId,t.onServerCall,t)})};n.prototype={constructor:n,onInit:SJ.emptyFn,updateServerDescription:function(e){var n=[];SJ.Object.each(e,function(e){n.push(e)}),this._serverDescriptionHolder.set(n)},onServerCall:function(e){var n=e.args||[];if(e.callId){n.unshift(function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("servercallback_"+callId),SJ.iwc.EventBus.fire.apply(SJ.iwc.EventBus,e)})}else n.unshift(SJ.emptyFn);this[e.methodName].apply(this,n)}},e.Server=n}(SJ.ns("iwc"));